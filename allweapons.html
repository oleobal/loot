<head>
	<title>Weapon list</title>
	<meta charset="utf-8"/>
	<script src="utility.js"></script>
	<script src="web-utility.js"></script>
	<script src="list-melee-weapons.js"></script>
	<script src="list-ranged-weapons.js"></script>
	<script src="list-armors.js"></script>
	<script src="weapons.js"></script>
	<script>
	
	function addPieComparator(a, b)
	{
		return b.per-a.per
	}
	
	function addPie(chest, tableid)
	{
		//this does not use the 'pies' because reading them is not easy
		
		
		var probSum=0
		var items = []
		for (var i in chest)
		{
			probSum+=chest[i].commonness[0]
			items.push({name:chest[i].name, cat:chest[i].cat.toString(), per:undefined})
		}
		for (var i in items)
			items[i].per=(chest[i].commonness[0]/probSum)*100
			
		// PER CLASS
		var ptotal=0
		table=document.getElementById(tableid)
		for (var i in items)
		{
			var tr = document.createElement("tr")
			tr.style.backgroundColor=getLightRGBfromString(items[i].cat.toString())
			var tdn = document.createElement("td")
			
			// using the pie as an  index
			
			var a = document.createElement("a")
			a.href = window.location.pathname+"#"+items[i].name.replace(/\ /g, "_").toLowerCase()
			a.innerHTML=items[i].name
			tdn.appendChild(a)
			
			//tdn.innerHTML = items[i].name
			tr.appendChild(tdn)
			var tdc = document.createElement("td")
			tdc.innerHTML = items[i].cat
			tr.appendChild(tdc)
			var tdp = document.createElement("td")
			tdp.innerHTML=items[i].per.toFixed(2)+"%"
			ptotal+=items[i].per
			tr.appendChild(tdp)
			table.appendChild(tr)
		}
		var ptotaltr = document.createElement("tr")
		var tdn = document.createElement("td")
		tdn.innerHTML="Total"
		ptotaltr.appendChild(tdn)
		ptotaltr.appendChild(document.createElement("td"))
		var tdt = document.createElement("td")
		tdt.innerHTML=ptotal.toFixed(2)
		ptotaltr.appendChild(tdt)
		table.appendChild(ptotaltr)
		
		// SORTED PER PERCENTAGE
		
		items.sort(addPieComparator)
		table=document.getElementById(tableid+"PercentageSort")
		var ptotal=0
		for (var i in items)
		{
			var tr = document.createElement("tr")
			tr.style.backgroundColor=getLightRGBfromString(items[i].cat.toString())
			var tdn = document.createElement("td")
			tdn.innerHTML = items[i].name
			tr.appendChild(tdn)
			var tdc = document.createElement("td")
			tdc.innerHTML = items[i].cat
			tr.appendChild(tdc)
			var tdp = document.createElement("td")
			tdp.innerHTML=items[i].per.toFixed(2)+"%"
			ptotal+=items[i].per
			tr.appendChild(tdp)
			table.appendChild(tr)
		}
		var ptotaltr = document.createElement("tr")
		var tdn = document.createElement("td")
		tdn.innerHTML="Total"
		ptotaltr.appendChild(tdn)
		ptotaltr.appendChild(document.createElement("td"))
		var tdt = document.createElement("td")
		tdt.innerHTML=ptotal.toFixed(2)
		ptotaltr.appendChild(tdt)
		table.appendChild(ptotaltr)
		
		
		
		// PER-CLASS PERCENTAGE
		
		var classes = {}
		
		table=document.getElementById(tableid+"Classes")
		for (var i in items)
		{
			var s = items[i].cat.toString()
			if (classes[s] == undefined)
				classes[s]={cat:s, per:items[i].per}
			else
				classes[s].per+=items[i].per
		}
		
		var cats = []
		for (var i in classes)
		{
			cats.push(classes[i])
		}
		cats.sort(addPieComparator)
		
		var ptotal=0
		for (var i in cats)
		{
			var tr = document.createElement("tr")
			tr.style.backgroundColor=getLightRGBfromString(cats[i].cat.toString())
			var tdn = document.createElement("td")
			tdn.innerHTML = cats[i].cat
			tr.appendChild(tdn)
			var tdp = document.createElement("td")
			tdp.innerHTML=cats[i].per.toFixed(2)+"%"
			ptotal+=cats[i].per
			tr.appendChild(tdp)
			table.appendChild(tr)
		}
		var ptotaltr = document.createElement("tr")
		var tdn = document.createElement("td")
		tdn.innerHTML="Total"
		ptotaltr.appendChild(tdn)
		var tdt = document.createElement("td")
		tdt.innerHTML=ptotal.toFixed(2)
		ptotaltr.appendChild(tdt)
		table.appendChild(ptotaltr)
		
	}
	
	function displayAll()
	{
		addPie(melee.items.concat(ranged.items).concat(armor.items), "weaponsPie")
		var o = {colors:true, perweapon:true}
		var c = getAllWeaponCombinations(melee.items, melee.goodMods.concat(melee.badMods.slice(1)))
		c = c.concat(getAllWeaponCombinations(ranged.items, ranged.goodMods.concat(ranged.badMods.slice(1))))
		c = c.concat(getAllWeaponCombinations(armor.items, armor.goodMods.concat(armor.badMods.slice(1))))
		displayWeapons(c,o)
	}
	</script>
	<style>
	.gray {
		background-color:#EEE;
	}
	a:link {
	color: #00C;
	}
	a:visited {
		color: #00C;
	}
	td {
		padding-right: 0.5em;
		padding-left: 0.5em;
	}
	</style>
</head>
<body onload='displayAll()'>

<table id="weaponsPie" style="display:inline-block; vertical-align:top;">
	<tr>
		<th style="min-width:12em;">Name</th>
		<th style="min-width:10em;">Classes</th>
		<th style="min-width:2em;" >Percentage</th>
	</tr>
</table> 
<table id="weaponsPiePercentageSort" style="display:inline-block; vertical-align:top;">
	<tr>
		<th style="min-width:12em;">Name</th>
		<th style="min-width:10em;">Classes</th>
		<th style="min-width:2em;" >Percentage</th>
	</tr>
</table> 
<table id="weaponsPieClasses" style="display:inline-block; vertical-align:top;">
	<tr>
		<th style="min-width:10em;">Classes</th>
		<th style="min-width:2em;" >Percentage</th>
	</tr>
</table> 

<h3 id="melee"><a href="#melee">Melee Weapons</a></h3>

<table id="MeleeWeaponsTable" style="">
	<tr>
		<th style="min-width:12em;">Name</th>
		<th style="min-width:10em;">Classes</th>
		<th style="min-width:2em;" >ATK</th>
		<th style="min-width:2em;" >PAR</th>
		<th style="min-width:2em;" >DMG</th>
		<th style="min-width:2em;" >Hands</th>
		<th style="min-width:5em;" >Weight</th>
		<th style="min-width:3em;" >Value</th>
		<th style="width:100%;"    >Notes</th>
	</tr>
</table>

<h3 id="ranged"><a href="#ranged">Ranged weapons</a></h3>


<table id="RangedWeaponsTable">
	<tr>
		<th style="min-width:12em;" >Name</th>
		<th style="min-width:9em;"  >Classes</th>
		<th style="min-width:3.5em;">min</th> <!-- FIXME ??? Why .5 -->
		<th style="min-width:4em;"  >max</th>
		<th style="min-width:4em;"  >ATK</th>
		<th style="min-width:4em;"  >PAR</th>
		<th style="min-width:5em;"  >DMG</th>
		<th style="min-width:5em;"  >Hands</th>
		<th style="min-width:5em;"  >Weight</th>
		<th style="min-width:4em;"  >Value</th>
		<th style="width:100%;"     >Notes</th>
	</tr>
</table>

<h3 id="armor"><a href="#armor">Armor</a></h3>


<table id="ArmorTable" style="">
	<tr>
		<th style="min-width:12em;">Name</th>
		<th style="min-width:10em;">Classes</th>
		<th style="min-width:6em;" >DEX mod</th>
		<th style="min-width:4em;" >PROT</th>
		<th style="min-width:4em;" >Weight</th>
		<th style="min-width:3em;" >Value</th>
		<th style="width:100%;"    >Notes</th>
	</tr>
</table>

<p id="debug" style="font-family:monospace;">
</p>
</body>
